version: "3"

services:

  registry-service:
    image: registry-service
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "8761:8761"
    networks:
      - webnet

  gateway-service:
    image: gateway-service
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "9090:9090"
    depends_on:
      - registry-service
    networks:
      - webnet

  footballer-service:
    image: footballer-service
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "8081:8081"
    depends_on:
      - registry-service
    networks:
      - webnet

  team-service:
    image: team-service
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "8082:8082"
    depends_on:
      - registry-service
      - team-db
    networks:
      - webnet

  footballer-db:
    image: mongo
    deploy:
          replicas: 1
          restart_policy:
            condition: on-failure
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - "footballer-db-data:/data/db"
    ports:
      - "27081:27017"
    depends_on:
      - registry-service
      - team-db
    networks:
      - webnet

  team-db:
    image: mongo
    deploy:
          replicas: 1
          restart_policy:
            condition: on-failure
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - "team-db-data:/data/db"
    ports:
      - "27082:27017"
    networks:
      - webnet


networks:
  webnet:

volumes:
  footballer-db-data:
    external: true
  team-db-data:
    external: true